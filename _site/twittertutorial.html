<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitter API Tutorial</title>

    <!-- CSS -->
    <link href="./dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/class.css" rel="stylesheet">   
    <link href="assets/css/syntax.css" rel="stylesheet" >
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

    <!-- MathJax -->
    <script type="text/javascript"
      src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
  </head>
  <body>
    <a class="sr-only" href="#content">Skip to main content</a>

    <!-- Docs master nav -->
    <header class="navbar navbar-fixed-top navbar-default" role="banner">
      <div class="container">
        <div class="row">
        <div class="navbar-header">
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <ul class="nav navbar-nav">
            <div class="hidden-sm hidden-xs"><li id="main_page"><a href="index.html" class="navbar-brand">Social Media & Text Analytics</a></li></div>
            <div class="visible-sm visible-xs"><li id="main_page"><a href="index.html" class="navbar-brand">Social Media & Text Analytics</a></li></div>
          </ul>
        </div>
        <nav class="collapse navbar-collapse" role="navigation">
          <ul class="nav navbar-nav">
            <li id="syllabus"><a href="syllabus.html">Syllabus</a></li>
            <li id="tutorial"><a href="twittertutorial.html">Twitter API Tutorial</a></li>
            <li id="homework">
              <a class="dropdown-toggle" data-toggle="dropdown" href="#">Homework<span class="caret"></span></a>
              <ol class="dropdown-menu">
                <li><a href="assignment0.html">0. Become a Twitter User</a></li>
                <li><a href="assignment1.html">1. Twitter's Language Mix</a></li>
          </ul>
        </nav>
      </div>
      </div>
    </header>

    <div class="container">
      <div class="row">
        <div class="col-sm-2 hidden-sm hidden-xs">
          <a href="http://business.time.com/2013/11/06/how-twitter-slayed-the-fail-whale/"> 
          <img src="assets/img/failwhale.jpg" class="img-responsive img-rounded" alt=""/>
          </a> 
          <span class="text-muted"><i>Twitter's 404 error page -- the Fail Whale</i></span>
        </div>
        <div class="col-sm-10">
          <h1 id="twitter-api-tutorial">Twitter API tutorial</h1>

<p><strong>by <a href="http://www.cis.upenn.edu/~xwe/">Wei Xu</a></strong> <a class="twitter-follow-button" data-show-count="false" href="https://twitter.com/cocoweixu">Follow @cocoweixu</a> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script> <strong>  (University of Pennsylvania)</strong></p>

<p>last updated Feb 28, 2016; originally written July 1, 2015</p>

<h3 id="getting-twitter-api-keys">1. Getting Twitter API keys</h3>

<p>To start with, you will need to have a Twitter account and obtain credentials (i.e. API key, API secret, Access token and Access token secret) on the Twitter developer site to access the Twitter API, following these steps:</p>

<ul>
  <li>Create a Twitter user account if you do not already have one.</li>
  <li>Go to <a href="https://apps.twitter.com/">https://apps.twitter.com/</a> and log in with your Twitter user account. This step gives you a Twitter dev account under the same name as your user account.</li>
  <li>Click “Create New App”</li>
  <li>Fill out the form, agree to the terms, and click “Create your Twitter application”</li>
  <li>In the next page, click on “Keys and Access Tokens” tab, and copy your “API key” and “API secret”. Scroll down and click “Create my access token”, and copy your “Access token” and “Access token secret”.</li>
</ul>

<h3 id="installing-a-twitter-library">2. Installing a Twitter library</h3>

<p>We will be using a Python library called <a href="https://pypi.python.org/pypi/twitter">Python Twitter Tools</a> to connect to Twitter API and downloading the data from Twitter. There are <a href="https://dev.twitter.com/overview/api/twitter-libraries&gt;">many other libraries</a> in various programming languages that let you use Twitter API. We choose the Python Twitter Tools for this tutorial, because it is simple to use yet fully supports the Twitter API. </p>

<p>Download the Python Twitter tools at <a href="https://pypi.python.org/pypi/twitter">https://pypi.python.org/pypi/twitter</a>.</p>

<p>Install the Python Twitter Tools package by typing in commands:</p>

<div class="highlight"><pre><code class="language-csh" data-lang="csh"><span class="nv">$ </span>python setup.py --help
<span class="nv">$ </span>python setup.py build     
<span class="nv">$ </span>python setup.py install</code></pre></div>

<h3 id="connecting-to-twitter-streaming-apis">3. Connecting to Twitter Streaming APIs</h3>

<p>The Streaming APIs give access to (usually a sample of) all tweets as they published on Twitter. On average, about 6,000 tweets per second are posted on Twitter and you (normal dev users) will get a small proportion (&lt;=1%) of it. The Streaming APIs are one of the two types of Twitter APIs. The other one called REST APIs (we will talk about later in this tutorial), which is more suitable for singular searches, such as searching historic tweets, reading user profile information, or posting Tweets. The Streaming API <strong>only</strong> sends out real-time tweets, while the Search API (one of the popular REST APIs) gives historical tweets up to about a week with a max of a couple of hundreds. You may request elevated access (e.g. Firehose, Retweet, Link, Birddog or Shadow) for more data by contacting Twitter’s API support. </p>

<h4 id="basic-uses-of-streaming-apis">Basic Uses of Streaming APIs</h4>

<p>Create a file called <em>twitter_streaming.py</em>, and copy the code below into it. Make sure to enter your credentials obtained in the Step 1 above into ACCESS_TOKEN, ACCESS_SECRET, CONSUMER_KEY, and CONSUMER_SECRET.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Import the necessary package to process data in JSON format</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">json</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">simplejson</span> <span class="kn">as</span> <span class="nn">json</span>

<span class="c"># Import the necessary methods from &quot;twitter&quot; library</span>
<span class="kn">from</span> <span class="nn">twitter</span> <span class="kn">import</span> <span class="n">Twitter</span><span class="p">,</span> <span class="n">OAuth</span><span class="p">,</span> <span class="n">TwitterHTTPError</span><span class="p">,</span> <span class="n">TwitterStream</span>

<span class="c"># Variables that contains the user credentials to access Twitter API </span>
<span class="n">ACCESS_TOKEN</span> <span class="o">=</span> <span class="s">&#39;YOUR ACCESS TOKEN&quot;&#39;</span>
<span class="n">ACCESS_SECRET</span> <span class="o">=</span> <span class="s">&#39;YOUR ACCESS TOKEN SECRET&#39;</span>
<span class="n">CONSUMER_KEY</span> <span class="o">=</span> <span class="s">&#39;YOUR API KEY&#39;</span>
<span class="n">CONSUMER_SECRET</span> <span class="o">=</span> <span class="s">&#39;ENTER YOUR API SECRET&#39;</span>

<span class="n">oauth</span> <span class="o">=</span> <span class="n">OAuth</span><span class="p">(</span><span class="n">ACCESS_TOKEN</span><span class="p">,</span> <span class="n">ACCESS_SECRET</span><span class="p">,</span> <span class="n">CONSUMER_KEY</span><span class="p">,</span> <span class="n">CONSUMER_SECRET</span><span class="p">)</span>

<span class="c"># Initiate the connection to Twitter Streaming API</span>
<span class="n">twitter_stream</span> <span class="o">=</span> <span class="n">TwitterStream</span><span class="p">(</span><span class="n">auth</span><span class="o">=</span><span class="n">oauth</span><span class="p">)</span>

<span class="c"># Get a sample of the public data following through Twitter</span>
<span class="n">iterator</span> <span class="o">=</span> <span class="n">twitter_stream</span><span class="o">.</span><span class="n">statuses</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>

<span class="c"># Print each tweet in the stream to the screen </span>
<span class="c"># Here we set it to stop after getting 1000 tweets. </span>
<span class="c"># You don&#39;t have to set it to stop, but can continue running </span>
<span class="c"># the Twitter API to collect data for days or even longer. </span>
<span class="n">tweet_count</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>
    <span class="n">tweet_count</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="c"># Twitter Python Tool wraps the data returned by Twitter </span>
    <span class="c"># as a TwitterDictResponse object.</span>
    <span class="c"># We convert it back to the JSON format to print/score</span>
    <span class="k">print</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">tweet</span><span class="p">)</span>  
    
    <span class="c"># The command below will do pretty printing for JSON data, try it out</span>
    <span class="c"># print json.dumps(tweet, indent=4)</span>
       
    <span class="k">if</span> <span class="n">tweet_count</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">break</span></code></pre></div>

<p>If you run the program by typing in the command:</p>

<div class="highlight"><pre><code class="language-csh" data-lang="csh"><span class="nv">$ </span>python twitter_streaming.py</code></pre></div>

<p>You will see tweets keep flowing in your screen. They are a sample of public data (including tweets and also events) flowing though Twitter at the moment. The data returned is in <a href="https://en.wikipedia.org/wiki/JSON">JSON</a> format. It may looks too much for now; it will become clearer in the next step how to read and process this data. Below is one example tweet: </p>

<p align="center"><img src="/assets/img/my_tweet.png" align="center" style="border:1px solid grey" height="200" /></p>

<p>and its JSON format (often output without line breaks to save space but difficult to read and make sense of — but you can do pretty printing to include line breaks to make it more readable as shown in Step 5) :</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">{</span><span class="s2">&quot;favorited&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="s2">&quot;contributors&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="s2">&quot;truncated&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="o">:</span> <span class="s2">&quot;#CFP Workshop on Noisy User-generated Text at ACL - Beijing 31 July 2015. Papers due: 11 May 2015. http://t.co/rcygyEowqH   #NLProc #WNUT15&quot;</span><span class="p">,</span> <span class="s2">&quot;possibly_sensitive&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="s2">&quot;in_reply_to_status_id&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;follow_request_sent&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="s2">&quot;profile_use_background_image&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="s2">&quot;default_profile_image&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">237918251</span><span class="p">,</span> <span class="s2">&quot;verified&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="s2">&quot;profile_image_url_https&quot;</span><span class="o">:</span> <span class="s2">&quot;https://pbs.twimg.com/profile_images/527088456967544832/DnclpoZO_normal.jpeg&quot;</span><span class="p">,</span> <span class="s2">&quot;profile_sidebar_fill_color&quot;</span><span class="o">:</span> <span class="s2">&quot;DDEEF6&quot;</span><span class="p">,</span> <span class="s2">&quot;profile_text_color&quot;</span><span class="o">:</span> <span class="s2">&quot;333333&quot;</span><span class="p">,</span> <span class="s2">&quot;followers_count&quot;</span><span class="o">:</span> <span class="mi">226</span><span class="p">,</span> <span class="s2">&quot;profile_sidebar_border_color&quot;</span><span class="o">:</span> <span class="s2">&quot;C0DEED&quot;</span><span class="p">,</span> <span class="s2">&quot;id_str&quot;</span><span class="o">:</span> <span class="s2">&quot;237918251&quot;</span><span class="p">,</span> <span class="s2">&quot;profile_background_color&quot;</span><span class="o">:</span> <span class="s2">&quot;C0DEED&quot;</span><span class="p">,</span> <span class="s2">&quot;listed_count&quot;</span><span class="o">:</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;profile_background_image_url_https&quot;</span><span class="o">:</span> <span class="s2">&quot;https://abs.twimg.com/images/themes/theme1/bg.png&quot;</span><span class="p">,</span> <span class="s2">&quot;utc_offset&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="s2">&quot;statuses_count&quot;</span><span class="o">:</span> <span class="mi">120</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;I am a postdoctoral researcher @PennCIS, studying Natural Language Processing and Social Media.&quot;</span><span class="p">,</span> <span class="s2">&quot;friends_count&quot;</span><span class="o">:</span> <span class="mi">166</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="o">:</span> <span class="s2">&quot;Philadelphia PA&quot;</span><span class="p">,</span> <span class="s2">&quot;profile_link_color&quot;</span><span class="o">:</span> <span class="s2">&quot;0084B4&quot;</span><span class="p">,</span> <span class="s2">&quot;profile_image_url&quot;</span><span class="o">:</span> <span class="s2">&quot;http://pbs.twimg.com/profile_images/527088456967544832/DnclpoZO_normal.jpeg&quot;</span><span class="p">,</span> <span class="s2">&quot;following&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="s2">&quot;geo_enabled&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="s2">&quot;profile_background_image_url&quot;</span><span class="o">:</span> <span class="s2">&quot;http://abs.twimg.com/images/themes/theme1/bg.png&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Wei Xu&quot;</span><span class="p">,</span> <span class="s2">&quot;lang&quot;</span><span class="o">:</span> <span class="s2">&quot;en&quot;</span><span class="p">,</span> <span class="s2">&quot;profile_background_tile&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="s2">&quot;favourites_count&quot;</span><span class="o">:</span> <span class="mi">88</span><span class="p">,</span> <span class="s2">&quot;screen_name&quot;</span><span class="o">:</span> <span class="s2">&quot;cocoweixu&quot;</span><span class="p">,</span> <span class="s2">&quot;notifications&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;http://www.cis.upenn.edu/~xwe/&quot;</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="o">:</span> <span class="s2">&quot;Thu Jan 13 23:15:12 +0000 2011&quot;</span><span class="p">,</span> <span class="s2">&quot;contributors_enabled&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="s2">&quot;time_zone&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="s2">&quot;protected&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="s2">&quot;default_profile&quot;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="s2">&quot;is_translator&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">},</span> <span class="s2">&quot;filter_level&quot;</span><span class="o">:</span> <span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;geo&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">616333141884674048</span><span class="p">,</span> <span class="s2">&quot;favorite_count&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;lang&quot;</span><span class="o">:</span> <span class="s2">&quot;en&quot;</span><span class="p">,</span> <span class="s2">&quot;entities&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;user_mentions&quot;</span><span class="o">:</span> <span class="p">[],</span> <span class="s2">&quot;symbols&quot;</span><span class="o">:</span> <span class="p">[],</span> <span class="s2">&quot;trends&quot;</span><span class="o">:</span> <span class="p">[],</span> <span class="s2">&quot;hashtags&quot;</span><span class="o">:</span> <span class="p">[{</span><span class="s2">&quot;indices&quot;</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="s2">&quot;text&quot;</span><span class="o">:</span> <span class="s2">&quot;CFP&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;indices&quot;</span><span class="o">:</span> <span class="p">[</span><span class="mi">124</span><span class="p">,</span> <span class="mi">131</span><span class="p">],</span> <span class="s2">&quot;text&quot;</span><span class="o">:</span> <span class="s2">&quot;NLProc&quot;</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;indices&quot;</span><span class="o">:</span> <span class="p">[</span><span class="mi">132</span><span class="p">,</span> <span class="mi">139</span><span class="p">],</span> <span class="s2">&quot;text&quot;</span><span class="o">:</span> <span class="s2">&quot;WNUT15&quot;</span><span class="p">}],</span> <span class="s2">&quot;urls&quot;</span><span class="o">:</span> <span class="p">[{</span><span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;http://t.co/rcygyEowqH&quot;</span><span class="p">,</span> <span class="s2">&quot;indices&quot;</span><span class="o">:</span> <span class="p">[</span><span class="mi">99</span><span class="p">,</span> <span class="mi">121</span><span class="p">],</span> <span class="s2">&quot;expanded_url&quot;</span><span class="o">:</span> <span class="s2">&quot;http://noisy-text.github.io&quot;</span><span class="p">,</span> <span class="s2">&quot;display_url&quot;</span><span class="o">:</span> <span class="s2">&quot;noisy-text.github.io&quot;</span><span class="p">}]},</span> <span class="s2">&quot;in_reply_to_user_id_str&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="s2">&quot;retweeted&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="s2">&quot;coordinates&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="s2">&quot;timestamp_ms&quot;</span><span class="o">:</span> <span class="s2">&quot;1435780246598&quot;</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;&lt;a href=\&quot;http://twitter.com\&quot; rel=\&quot;nofollow\&quot;&gt;Twitter Web Client&lt;/a&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;in_reply_to_status_id_str&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="s2">&quot;in_reply_to_screen_name&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="s2">&quot;id_str&quot;</span><span class="o">:</span> <span class="s2">&quot;616333141884674048&quot;</span><span class="p">,</span> <span class="s2">&quot;place&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="s2">&quot;retweet_count&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;created_at&quot;</span><span class="o">:</span> <span class="s2">&quot;Wed Jul 01 19:50:46 +0000 2015&quot;</span><span class="p">,</span> <span class="s2">&quot;in_reply_to_user_id&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">}</span></code></pre></div>

<p>You can run the program and save the data into a file for analysis later using the following commend:</p>

<div class="highlight"><pre><code class="language-csh" data-lang="csh"><span class="nv">$ </span>python twitter_streaming.py &gt; twitter_stream_1000tweets.txt</code></pre></div>

<h4 id="advanced-uses-of-streaming-apis">Advanced Uses of Streaming APIs</h4>

<p>The streaming API provides more advanced functions. </p>

<p>First, you can set different parameters (see <a href="https://dev.twitter.com/streaming/overview/request-parameters">here</a> for a complete list) to define what data to request. For example, you can track certain tweets by specifying keywords or location or language etc. The following code will get the tweets in English that include the term “Google”:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">iterator</span> <span class="o">=</span> <span class="n">twitter_stream</span><span class="o">.</span><span class="n">statuses</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">track</span><span class="o">=</span><span class="s">&quot;Google&quot;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">)</span></code></pre></div>

<p><strong>Location is a bit tricky</strong>. Read <a href="https://dev.twitter.com/streaming/overview/request-parameters#locations">here</a> for a simple guide, and <a href="http://thoughtfaucet.com/search-twitter-by-location/">here</a> for a complete guide. Find tweets by location can be done either by the Streaming API (only geolocated tweets) or the Search API (user’s location field is also used). </p>

<p>Second, by default, streaming API is connecting to the “public streams” — all public data on Twitter as we showed in the above example. Also, there are “user streams” and “site streams” that contains the data specific to the authenticated user or users (see <a href="https://dev.twitter.com/streaming/overview">here</a> for more details). For conducting research on Twitter data, you usually only need to use “public streams” to collect data. In case you do need to use other streams, here is how to specify it:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">twitter_userstream</span> <span class="o">=</span> <span class="nx">TwitterStream</span><span class="p">(</span><span class="nx">auth</span><span class="o">=</span><span class="nx">oauth</span><span class="p">,</span> <span class="nx">domain</span><span class="o">=</span><span class="s1">&#39;userstream.twitter.com&#39;</span><span class="p">)</span></code></pre></div>

<h3 id="reading-and-processing-tweets-in-json-format">4. Reading and Processing Tweets in JSON format</h3>

<p>The streaming API returns <a href="https://dev.twitter.com/overview/api/tweets">tweets</a>, as well as several <a href="https://dev.twitter.com/streaming/overview/messages-types">other types of messages</a> (e.g. a tweet deletion notice, user update profile notice, etc), all in JSON format. Here we demonstrate how to read and process tweets in details. Other data in JSON format can be processed similarly. </p>

<p>Tweets, also known more generically as “status updates”. This map made by Raffi Krikorian  explains a tweet in JSON format:</p>

<p><img src="/assets/img/raffi-krikorian-map-of-a-tweet.png" width="600" /></p>

<p>Although this map is from 2010 and a bit out-of-date, it is a good visualization of tweet’s JSON format. You can find the up-to-date information of tweet’s format <a href="https://dev.twitter.com/overview/api/tweets">here</a>.</p>

<p>Use Python library <em>json</em> or <em>simplejson</em> to read in the data in JSON format and process them:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Import the necessary package to process data in JSON format</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">json</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">simplejson</span> <span class="kn">as</span> <span class="nn">json</span>

<span class="c"># We use the file saved from last step as example</span>
<span class="n">tweets_filename</span> <span class="o">=</span> <span class="s">&#39;twitter_stream_1000tweets.txt&#39;</span>
<span class="n">tweets_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">tweets_filename</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">tweets_file</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c"># Read in one line of the file, convert it into a json object </span>
        <span class="n">tweet</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">if</span> <span class="s">&#39;text&#39;</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">:</span> <span class="c"># only messages contains &#39;text&#39; field is a tweet</span>
            <span class="k">print</span> <span class="n">tweet</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="c"># This is the tweet&#39;s id</span>
            <span class="k">print</span> <span class="n">tweet</span><span class="p">[</span><span class="s">&#39;created_at&#39;</span><span class="p">]</span> <span class="c"># when the tweet posted</span>
            <span class="k">print</span> <span class="n">tweet</span><span class="p">[</span><span class="s">&#39;text&#39;</span><span class="p">]</span> <span class="c"># content of the tweet</span>
                        
            <span class="k">print</span> <span class="n">tweet</span><span class="p">[</span><span class="s">&#39;user&#39;</span><span class="p">][</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="c"># id of the user who posted the tweet</span>
            <span class="k">print</span> <span class="n">tweet</span><span class="p">[</span><span class="s">&#39;user&#39;</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="c"># name of the user, e.g. &quot;Wei Xu&quot;</span>
            <span class="k">print</span> <span class="n">tweet</span><span class="p">[</span><span class="s">&#39;user&#39;</span><span class="p">][</span><span class="s">&#39;screen_name&#39;</span><span class="p">]</span> <span class="c"># name of the user account, e.g. &quot;cocoweixu&quot;</span>

            <span class="n">hashtags</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">hashtag</span> <span class="ow">in</span> <span class="n">tweet</span><span class="p">[</span><span class="s">&#39;entities&#39;</span><span class="p">][</span><span class="s">&#39;hashtags&#39;</span><span class="p">]:</span>
            	<span class="n">hashtags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hashtag</span><span class="p">[</span><span class="s">&#39;text&#39;</span><span class="p">])</span>
            <span class="k">print</span> <span class="n">hashtags</span>

    <span class="k">except</span><span class="p">:</span>
        <span class="c"># read in a line is not in JSON format (sometimes error occured)</span>
        <span class="k">continue</span></code></pre></div>

<p>If, instead of the file <em>twitter_stream_1000tweets.txt</em>, use the example tweet in JSON format in the Streaming API section, this piece of code will output the following results:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">616333141884674048
Wed Jul 01 19:50:46 +0000 2015
#CFP Workshop on Noisy User-generated Text at ACL - Beijing 31 July 2015. Papers due: 11 May 2015. http://t.co/rcygyEowqH   #NLProc #WNUT15
237918251
Wei Xu
cocoweixu
[u&#39;CFP&#39;, u&#39;NLProc&#39;, u&#39;WNUT15&#39;]</code></pre></div>

<p>Note that the same url will have a few different versions in the Twitter stream: <em>http://t.co/rcygyEowqH</em> in the text, <em>http://noisy-text.github.io</em> as the expanded full version, <em>noisy-text.github.io</em> as the display version. </p>

<p>For long-term data collection, you can setup a <a href="https://en.wikipedia.org/wiki/Cron">cron job</a>. If you are interested in running a long term collection of one or multiple streaming queries, consider using <a href="http://www.cs.jhu.edu/~mdredze/">Mark Dredze</a>’s Twitter
streaming <a href="https://github.com/mdredze/twitter_stream_downloader">library</a>. 
This library wraps the basic streaming API with
several helpful features, such as organizing data into files by data,
support for multiple feed types, and ensuring feeds remain active
after interruptions. You can run this library inside of crontab or
supervisord.</p>

<h3 id="using-twitter-search-api-and-trends-api">5. Using Twitter Search API and Trends API</h3>

<p>Besides the streaming APIs, Twitter also provide another type of APIs — REST APIs. It provides two main functionalities: <em>GET</em> data from Twitter and <em>POST</em> data (e.g. a tweet from your account) to Twitter. In this tutorial, we will demonstrate three most useful APIs to collect data for social media research: Search (tweets contain certain words), Trends (trending topics) and User (a user’s tweets, followers, friends, etc.). For explanations of these key types of data offered by Twitter, see the <a href="syllabus.html">lecture slides</a> on this course website.</p>

<h4 id="search-api">Search API</h4>

<p>Similar to the Streaming API, you first import necessary Python packages and OAuth credentials as in Step 2. Then you can use search API like follows:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Initiate the connection to Twitter REST API</span>
<span class="n">twitter</span> <span class="o">=</span> <span class="n">Twitter</span><span class="p">(</span><span class="n">auth</span><span class="o">=</span><span class="n">oauth</span><span class="p">)</span>
            
<span class="c"># Search for latest tweets about &quot;#nlproc&quot;</span>
<span class="n">twitter</span><span class="o">.</span><span class="n">search</span><span class="o">.</span><span class="n">tweets</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="s">&#39;#nlproc&#39;</span><span class="p">)</span></code></pre></div>

<p>Alternatively, you can search with more parameters (see a full list <a href="https://dev.twitter.com/rest/public/search">here</a>). For example, search for 10 latest tweets about “#nlproc” in English:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">twitter</span><span class="o">.</span><span class="n">search</span><span class="o">.</span><span class="n">tweets</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="s">&#39;#nlproc&#39;</span><span class="p">,</span> <span class="n">result_type</span><span class="o">=</span><span class="s">&#39;recent&#39;</span><span class="p">,</span> <span class="n">lang</span><span class="o">=</span><span class="s">&#39;en&#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></code></pre></div>

<h4 id="trends-api">Trends API</h4>

<p>Twitter provides global trends and as well as localized tweets. The easiest and best way to see what trends are available and the place ids (which you will need to know to query localized trends or tweets), is by using this commend to request worldwide trends:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Get all the locations where Twitter provides trends service</span>
<span class="n">world_trends</span> <span class="o">=</span> <span class="n">twitter</span><span class="o">.</span><span class="n">trends</span><span class="o">.</span><span class="n">available</span><span class="p">(</span><span class="n">_woeid</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code></pre></div>

<p>It returns all the trends that are offered by Twitter at the time. Here is part of the returned results:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">{&quot;name&quot;: &quot;United States&quot;, &quot;countryCode&quot;: &quot;US&quot;, &quot;url&quot;: &quot;http://where.yahooapis.com/v1/place/23424977&quot;, &quot;country&quot;: &quot;United States&quot;, &quot;parentid&quot;: 1, &quot;placeType&quot;: {&quot;code&quot;: 12, &quot;name&quot;: &quot;Country&quot;}, &quot;woeid&quot;: 23424977}

{&quot;name&quot;: &quot;San Francisco&quot;, &quot;countryCode&quot;: &quot;US&quot;, &quot;url&quot;: &quot;http://where.yahooapis.com/v1/place/2487956&quot;, &quot;country&quot;: &quot;United States&quot;, &quot;parentid&quot;: 23424977, &quot;placeType&quot;: {&quot;code&quot;: 7, &quot;name&quot;: &quot;Town&quot;}, &quot;woeid&quot;: 2487956}

{&quot;name&quot;: &quot;Bangkok&quot;, &quot;countryCode&quot;: &quot;TH&quot;, &quot;url&quot;: &quot;http://where.yahooapis.com/v1/place/1225448&quot;, &quot;country&quot;: &quot;Thailand&quot;, &quot;parentid&quot;: 23424960, &quot;placeType&quot;: {&quot;code&quot;: 7, &quot;name&quot;: &quot;Town&quot;}, &quot;woeid&quot;: 1225448}</code></pre></div>

<p>The places ids are WOEIDs (Where On Earth ID), which are 32-bit identifiers provided by <a href="https://developer.yahoo.com/geo/geoplanet/guide/concepts.html">Yahoo! GeoPlanet</a> project. And yes! Twitter is very international. </p>

<p>After you know the ids for the places you are interested in, you can get the local trends like this:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Get all (it&#39;s always 10) trending topics in San Francisco (its WOEID is 2487956)</span>
<span class="n">sfo_trends</span> <span class="o">=</span> <span class="n">twitter</span><span class="o">.</span><span class="n">trends</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">_id</span> <span class="o">=</span> <span class="mi">2487956</span><span class="p">)</span></code></pre></div>

<p>The trends will be returned in JSON, again. This time we reformat JSON data in a prettier way to make it easier to read by human beings:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">print</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">sfo_trends</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span></code></pre></div>

<p>and get:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
   <span class="s2">&quot;created_at&quot;</span><span class="o">:</span><span class="s2">&quot;2015-07-01T22:09:55Z&quot;</span><span class="p">,</span>
   <span class="s2">&quot;trends&quot;</span><span class="o">:</span><span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;url&quot;</span><span class="o">:</span><span class="s2">&quot;http://twitter.com/search?q=%23LiesIveToldMyParents&quot;</span><span class="p">,</span>
         <span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="s2">&quot;%23LiesIveToldMyParents&quot;</span><span class="p">,</span>
         <span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;#LiesIveToldMyParents&quot;</span><span class="p">,</span>
         <span class="s2">&quot;promoted_content&quot;</span><span class="o">:</span><span class="kc">null</span>
      <span class="p">},</span>
      <span class="p">{</span>
         <span class="s2">&quot;url&quot;</span><span class="o">:</span><span class="s2">&quot;http://twitter.com/search?q=%22Kevin+Love%22&quot;</span><span class="p">,</span>
         <span class="s2">&quot;query&quot;</span><span class="o">:</span><span class="s2">&quot;%22Kevin+Love%22&quot;</span><span class="p">,</span>
         <span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;Kevin Love&quot;</span><span class="p">,</span>
         <span class="s2">&quot;promoted_content&quot;</span><span class="o">:</span><span class="kc">null</span>
      <span class="p">},</span>
      
      <span class="p">...</span> <span class="p">[</span><span class="nx">and</span> <span class="nx">another</span> <span class="mi">8</span> <span class="nx">trends</span> <span class="nx">omitted</span> <span class="nx">here</span> <span class="nx">to</span> <span class="nx">save</span> <span class="nx">space</span><span class="p">]</span>

<span class="p">}</span></code></pre></div>

<p>If you want to get the real tweets in each trend, use the Search API to get them.</p>

<p><strong>How often do the Twitter trending topics change?</strong> It is not disclosed by Twitter, but based on my experience, you will get most of them by querying every 5 minutes. </p>

<h4 id="user-api">User API</h4>

<p>Another popular use of API is to obtain the social graph of users’ followers and friends, as well as a particular user’s tweets. Below we show two common usage examples of the User APIs:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Get a list of followers of a particular user</span>
<span class="n">twitter</span><span class="o">.</span><span class="n">followers</span><span class="o">.</span><span class="n">ids</span><span class="p">(</span><span class="n">screen_name</span><span class="o">=</span><span class="s">&quot;cocoweixu&quot;</span><span class="p">)</span></code></pre></div>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Get a particular user&#39;s timeline (up to 3,200 of his/her most recent tweets)</span>
<span class="n">twitter</span><span class="o">.</span><span class="n">statuses</span><span class="o">.</span><span class="n">user_timeline</span><span class="p">(</span><span class="n">screen_name</span><span class="o">=</span><span class="s">&quot;billybob&quot;</span><span class="p">)</span></code></pre></div>

<h4 id="rate-limit">Rate Limit</h4>

<p>Unlike Streaming API, <strong>REST APIs have a strict rate limit</strong> on how many requests you can send given a time limit and how many tweets you can get access to for each request (and it got stricter and stricter in the past). The limits vary from one API function to another. Twitter’s dev website give a list of the rate limits <a href="https://dev.twitter.com/rest/public/rate-limits">here</a>.</p>

<p>You can also query the API to check your remaining quota, though you may rarely use this command:</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">twitter</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">rate_limit_status</span><span class="p">()</span></code></pre></div>

<h3 id="learning-more-about-twitter-apis">6. Learning More about Twitter APIs</h3>

<p>This tutorial is meant to help you to start. To learn more about Twitter APIs, here are two ways I found quite sufficient:</p>

<ul>
  <li>
    <p>Look up the <a href="https://dev.twitter.com/rest/public">documentation</a> of Twitter APIs to find the function you would like to use, then search in the <a href="https://github.com/sixohsix/twitter/">source code</a> of the Twitter Python Tools to see how to call it in your program.</p>
  </li>
  <li>
    <p>Check more example Python scripts that demonstrate interactions with the Twitter API
via the Python Twitter Tools: 
  <a href="https://github.com/ideoforms/python-twitter-examples">https://github.com/ideoforms/python-twitter-examples</a></p>
  </li>
</ul>

        </div>
      </div>

      <footer class="text-center text-muted">
        <hr/>
        Last updated July 05, 2016. <br/>
        Feel free to reuse any of the contents of this course or this web page. The source code is on <a href="https://github.com/socialmedia-class/">github <i class="fa fa-github-alt"></i></a>. <br/>
        <br/>
      </footer>
    </div>

    <!-- Page content of course! -->
    <!-- JS and analytics only. -->
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="./dist/js/bootstrap.js"></script>
    <script type="text/javascript">
      $(document).ready(function(){
        $("#tutorial").addClass("active");
      });
    </script>
  </body>
</html>
